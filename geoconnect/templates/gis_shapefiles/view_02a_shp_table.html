{% load humanize %}
{% if first_time_notify  and GEOCONNECT_STEP_KEY == STEP1_EXAMINE %}
    <!-- First time file is loaded, show a notification -->
    <div class="alert alert-success alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
      File <b>{{ shapefile_set.datafile_label }}</b> loaded! 
           &nbsp; (<b>{{ shapefile_set.number_of_features|intcomma }}</b> geospatial 
          feature{{ shapefile_set.number_of_features|pluralize }})
    </div>
{% endif %}


<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">1. {{ GEOCONNECT_STEP_KEY }} Shapefile</h3>
  </div>
  <div class="panel-body">
        The shapefile was successfully examined!
        
        <p>Press the button below to create a Map Layer:</p>
        
        <!-- send info to WorldMap API -->
		&nbsp; <a href="{% url 'view_send_shapefile_to_worldmap' shapefile_set.md5 %}" class="btn btn-info btn-xs">Visualize on WorldMap</a><br />
  </div><!-- end: panel body -->
</div><!-- end: panel -->

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Shapefile information</h3>
  </div>
  <div class="panel-body">
    Below are several details regarding the shapefile.
  </div><!-- end: panel body -->
  <table class="table table-bordered">
		<tr>
		    <th>File name</th>
			<td>{{ shapefile_set.datafile_label }}</td>
		</tr>
		{% if shapefile_set.dv_name %}
		<tr>
			<th>Dataverse</th>
			<td>{{ shapefile_set.dv_name }}</td>
		</tr>
		{% endif %}
		{% if shapefile_set.dataset_name %}
		<tr>
			<th>Dataset</th>
			<td>{{ shapefile_set.dataset_name}} (version id: {{ shapefile_set.dataset_version_id }})</td>
		</tr>
		{% endif %}
		{% if shapefile_set.dataset_description %}
		<tr>
			<th>Description</th>
			<td>{{ shapefile_set.dataset_description }}</td>
		</tr>
		{% endif %}
		<tr>
			<th>Shapefile Name</th>
			<td>{{ shapefile_set.get_basename }}  {#(<a href="{% url 'view_try_folium' shapefile_set.md5 %}" target="_blank">folium</a>)#}</td>
		</tr>
		<tr>
			<th>Dataverse User</th>
			<td>{{ shapefile_set.dv_username }}</td>
		</tr>
		<tr>
			<th># Features</th>
			<td>{{ shapefile_set.number_of_features|intcomma }}</td>
		</tr>
		<tr>
			<th>Files</th>
			<td>	<ul class="list-unstyled">
				{% for file_info in shapefile_set.get_file_info %}
					<li>{{ file_info }}</li>
				{% endfor %}
					</ul>
				</td>
		</tr>
		<tr>
			<th># Fields</th>
			<td>{{ shapefile_set.get_column_count|intcomma }}

				&nbsp; &nbsp;<a data-toggle="collapse" data-target="#column_name_list" id="btn_show_cols">show fields</a>
					<div id="column_name_list" class="collapse panel-body">
						 <table class="table table-bordered table-striped table-condensed">
							{% for fn in shapefile_set.get_column_info %}
								<tr>
									<td>{{ forloop.counter }}</td>
									{% if fn.1 == 'C' %}
										<td>{{ fn.0 }}</td>
										<!-- <td><a href="{#% url 'view_field_stats' shapefile_set.md5 fn.0 forloop.counter0 %#}">{{ fn.0 }} </a></td>	-->											
										<td>Character</td>
									{% else %}{% if fn.1 == 'N' %}
										<!--td><a href="{#% url 'view_field_stats' shapefile_set.md5 fn.0 forloop.counter0 %#}">{{ fn.0 }} </a></td-->
										<td><a href="javascript:alert('add stats');">{{ fn.0 }} </a></td>
										<td>Number</td>
									{% else %}{% if fn.1 == 'L' %}
										<!--td><a href="{#% url 'view_field_stats' shapefile_set.md5 fn.0 forloop.counter0 %#}">{{ fn.0 }} </a></td>-->
										<td><a href="javascript:alert('add stats');">{{ fn.0 }} </a></td>
										<td>Long</td>
									{% else %}{% if fn.1 == 'D' %}
										<td>{{ fn.0 }}</td>
										<td>Date</td>
										
									{% else %}{% if fn.1 == 'M' %}
										<td>{{ fn.0 }}</td>
										<td>Memo</td>
									{% else %}
										<td>{{ fn.0 }}</td>
										<td>{{ fn.1 }}<i>(Not recognized)</i></td>
									{% endif %}{% endif %}{% endif %}{% endif %}{% endif %}
								</tr>
							{% empty %}
								<tr><td>Sorry!  There are no column names.</td></tr>
							{% endfor %}
						</table>					     
			    </div>
				</td>
		</tr>
		<tr>
			<th>Bounding Box</th>
			<td>{{ shapefile_set.get_bounding_box }}</td>
		</tr>
		{% if import_fail_list %}
        <tr>
            <th>Previous import attempts</th>
		    <td>{% include "gis_shapefiles/view_02c_import_fails.html" %}</td>
		</tr>							  	    
		{% endif %}

	</table>
	</div><!-- end: panel -->
    
	<script>
	$('#column_name_list').on('show.bs.collapse', function () {
	  	$('#btn_show_cols').html('hide fields');	
	})
	$('#column_name_list').on('hide.bs.collapse', function () {
	  	$('#btn_show_cols').html('show fields');
	})
	</script>
	